# ======================================================
# ğŸ”§ SECTION : INSTALLATION + BUILD + PURGE CLOUDFLARE
# ======================================================

- name: ğŸ§© VÃ©rifier Node.js & NPM
  run: |
    echo "ğŸ” Version Node.js :"
    node -v
    echo "ğŸ” Version NPM :"
    npm -v

- name: ğŸ“¦ Installer les dÃ©pendances
  run: |
    echo "ğŸ“¦ Installation des dÃ©pendances..."
    npm ci || npm install
    npm install @vitejs/plugin-react --save-dev
    npm install tailwindcss postcss autoprefixer --save-dev

- name: ğŸ§± Build Vite + Tailwind
  run: |
    echo "ğŸ—ï¸ Construction du projet avec Vite + Tailwind..."
    npm run build || (echo "âŒ Erreur de build : arrÃªt du workflow" && exit 1)

- name: â˜ï¸ Purge du cache Cloudflare
  if: success()
  env:
    CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
    CLOUDFLARE_ZONE_ID: ${{ secrets.CLOUDFLARE_ZONE_ID }}
  run: |
    echo "ğŸš€ Purge du cache Cloudflare..."
    curl -X POST "https://api.cloudflare.com/client/v4/zones/$CLOUDFLARE_ZONE_ID/purge_cache" \
      -H "Authorization: Bearer $CF_API_TOKEN" \
      -H "Content-Type: application/json" \
      --data '{"purge_everything":true}' \
      && echo "âœ… Purge Cloudflare terminÃ©e avec succÃ¨s."