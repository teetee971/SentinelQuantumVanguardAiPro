name: 🌍 Wave 15 – Sentinel Live Dashboard (Real-Time Visualization)

on:
  schedule:
    - cron: "*/30 * * * *"     # rafraîchit toutes les 30 minutes
  workflow_dispatch:

jobs:
  dashboard:
    runs-on: ubuntu-latest
    name: 🛰️ Sentinel Dashboard Generator
    steps:
      - name: 🚀 Initialisation
        run: |
          echo "🌍 Lancement du générateur de dashboard Sentinel"
          mkdir -p public/status logs

      - name: 📥 Téléchargement des logs fusionnés
        uses: actions/download-artifact@v4
        with:
          name: sentinel-log-fusion
          path: logs/

      - name: 🧠 Génération du tableau de bord
        run: |
          echo "<!DOCTYPE html><html lang='fr'><head><meta charset='UTF-8'><title>Sentinel Live Dashboard</title>" > public/status/index.html
          echo "<meta name='viewport' content='
# 1️⃣ Se placer à la racine du projet
cd ~/SentinelQuantumVanguardAiPro

# 2️⃣ Créer le workflow
mkdir -p .github/workflows
cat > .github/workflows/sentinel-live-dashboard.yml <<'EOF'
name: 🌍 Wave 15 – Sentinel Live Dashboard (Real-Time Visualization)

on:
  schedule:
    - cron: "*/30 * * * *"     # rafraîchit toutes les 30 minutes
  workflow_dispatch:

jobs:
  dashboard:
    runs-on: ubuntu-latest
    name: 🛰️ Sentinel Dashboard Generator
    steps:
      - name: 🚀 Initialisation
        run: |
          echo "🌍 Lancement du générateur de dashboard Sentinel"
          mkdir -p public/status logs

      - name: 📥 Téléchargement des logs fusionnés
        uses: actions/download-artifact@v4
        with:
          name: sentinel-log-fusion
          path: logs/

      - name: 🧠 Génération du tableau de bord
        run: |
          echo "<!DOCTYPE html><html lang='fr'><head><meta charset='UTF-8'><title>Sentinel Live Dashboard</title>" > public/status/index.html
          echo "<meta name='viewport' content='width=device-width,initial-scale=1'><style>body{font-family:Inter,Roboto,Arial;background:#0b0f19;color:#e5e5e5;padding:2em;}h1{color:#00ffe0;}pre{background:#111827;padding:1em;border-radius:12px;white-space:pre-wrap;}</style></head><body>" >> public/status/index.html
          echo "<h1>🛰️ Sentinel Live Dashboard</h1><p>Mise à jour : $(date '+%F %T')</p><hr>" >> public/status/index.html
          echo "<h2>Derniers rapports fusionnés</h2><pre>" >> public/status/index.html
          tail -n 50 logs/fusion-summary.log >> public/status/index.html || echo "Aucune donnée disponible" >> public/status/index.html
          echo "</pre><hr><p style='font-size:0.9em;color:#888'>© $(date +%Y) Sentinel Quantum Vanguard AI Pro – Surveillance Active</p></body></html>" >> public/status/index.html

      - name: 🧾 Validation du fichier
        run: |
          echo "✅ Dashboard généré :"
          head -n 10 public/status/index.html

      - name: 📲 Notification Telegram (optionnelle)
        if: always()
        run: |
          if [ -n "${{ secrets.TELEGRAM_WEBHOOK }}" ]; then
            MSG="🌍 Dashboard mis à jour $(date '+%T') – accessible via /public/status "
            curl -s -X POST ${{ secrets.TELEGRAM_WEBHOOK }} -d "text=$MSG"
          fi

      - name: 🗂️ Upload du tableau de bord
        uses: actions/upload-artifact@v4
        with:
          name: sentinel-live-dashboard
          path: public/status/
