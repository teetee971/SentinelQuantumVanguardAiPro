name: üåç Sentinel Live Monitor ‚Äî Uptime & Health Check

on:
  schedule:
    - cron: "*/30 * * * *" # toutes les 30 minutes
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest

    steps:
      - name: üîç V√©rification accessibilit√© du site Sentinel
        id: sitecheck
        run: |
          echo "üîé Test d‚Äôaccessibilit√© du site..."
          URL="https://sentinelquantumvanguardaipro.pages.dev"
          STATUS=$(curl -o /dev/null -s -w "%{http_code}" $URL)
          echo "Statut HTTP : $STATUS"
          if [ "$STATUS" -eq 200 ]; then
            echo "‚úÖ Site en ligne et accessible."
            echo "result=success" >> $GITHUB_OUTPUT
          else
            echo "‚ö†Ô∏è Site inaccessible (code : $STATUS)"
            echo "result=failure" >> $GITHUB_OUTPUT
          fi

      - name: üß† Envoi notification Telegram (succ√®s)
        if: steps.sitecheck.outputs.result == 'success'
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          MSG="‚úÖ Sentinel Quantum Vanguard AI Pro est en ligne (%0AStatut HTTP 200)%0Aüåê https://sentinelquantumvanguardaipro.pages.dev"
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d "chat_id=${TELEGRAM_CHAT_ID}" \
            -d "text=$MSG" \
            -d "parse_mode=Markdown"

      - name: üö® Envoi notification Telegram (erreur)
        if: steps.sitecheck.outputs.result == 'failure'
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          MSG="üö® *ALERTE SENTINEL* : le site est inaccessible ou en erreur.%0A‚ö†Ô∏è Statut HTTP inattendu%0Aüåê https://sentinelquantumvanguardaipro.pages.dev"
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d "chat_id=${TELEGRAM_CHAT_ID}" \
            -d "text=$MSG" \
            -d "parse_mode=Markdown"