name: ğŸš€ Sentinel Auto-Deploy & Continuous Update

on:
  push:
    branches:
      - main
  workflow_dispatch:
  schedule:
    - cron: "*/15 * * * *" # VÃ©rifie toutes les 15 minutes si changements

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Checkout du dÃ©pÃ´t
        uses: actions/checkout@v4

      - name: ğŸ§° Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: âš™ï¸ Installation des dÃ©pendances
        run: |
          if [ -f package.json ]; then
            npm ci || npm install
          else
            echo "Aucun package.json trouvÃ©, passage en mode statique."
          fi

      - name: ğŸ—ï¸ Construction du projet
        run: |
          if [ -f package.json ]; then
            npm run build || echo "Pas de script build dÃ©fini"
          else
            echo "Rien Ã  compiler, mode statique actif."
          fi

      - name: â˜ï¸ DÃ©ploiement Cloudflare Pages
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
        run: |
          npm install -g wrangler
          wrangler pages publish public --project-name=sentinelquantumvanguardaipro
          echo "âœ… DÃ©ploiement terminÃ© avec succÃ¨s."

      - name: ğŸ“¡ Synchronisation GitHub Actions (backup & logs)
        uses: actions/upload-artifact@v4
        with:
          name: SentinelDeployLogs
          path: |
            public/
            wrangler.toml
            .github/workflows/

      - name: ğŸ“² Notification Telegram (succÃ¨s)
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.CHAT_ID }} \
            -d text="ğŸš€ Sentinel Quantum Vanguard AI Pro a Ã©tÃ© redÃ©ployÃ© automatiquement suite Ã  une mise Ã  jour."
